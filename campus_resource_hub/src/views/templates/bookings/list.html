{% extends "base.html" %}

{% block title %}My Bookings - Campus Resource Hub{% endblock %}

{% block content %}
<div class="container py-4">
    <h1 class="mb-4">My Bookings</h1>
    
    <!-- Bookings Section -->
    <h3 class="mb-3">Active Bookings</h3>
    {% if bookings %}
    <div class="table-responsive mb-4">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Resource</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Recurrence</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for booking in bookings %}
                <tr>
                    <td>{{ booking.resource.title }}</td>
                    <td>{{ booking.start_date|datetime }}</td>
                    <td>{{ booking.end_date|datetime }}</td>
                    <td>
                        {% if booking.recurrence_type %}
                        {% set child_count = booking.child_bookings|length if booking.child_bookings else 0 %}
                        {% set total_instances = child_count + 1 %}
                        <span class="badge bg-info" title="Repeats {{ booking.recurrence_type }} until {{ booking.recurrence_end_date|datetime if booking.recurrence_end_date else 'indefinitely' }} ({{ total_instances }} total instances)">
                            {{ booking.recurrence_type|title }} ({{ total_instances }})
                        </span>
                        {% else %}
                        <span class="text-muted">â€”</span>
                        {% endif %}
                    </td>
                    <td>
                        <span class="badge bg-{{ booking.status_color }}">
                            {{ booking.status|title }}
                        </span>
                    </td>
                    <td>
                        <a href="{{ url_for('booking.details', id=booking.id) }}" class="btn btn-sm btn-outline-primary">
                            View Details
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info mb-4">
        <p class="mb-0">You don't have any bookings yet.</p>
        <a href="{{ url_for('resources.search') }}" class="btn btn-primary mt-2">Browse Resources</a>
    </div>
    {% endif %}
    
    <!-- Waitlist Section -->
    <h3 class="mb-3">Waitlist Entries</h3>
    {% if waitlist_entries %}
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Resource</th>
                    <th>Requested Start</th>
                    <th>Requested End</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in waitlist_entries %}
                <tr>
                    <td>{{ entry.resource.title }}</td>
                    <td>{{ entry.requested_start_date|datetime }}</td>
                    <td>{{ entry.requested_end_date|datetime }}</td>
                    <td>
                        <span class="badge bg-warning">
                            {{ entry.status|title }}
                        </span>
                    </td>
                    <td>
                        <a href="{{ url_for('booking.waitlist_details', id=entry.id) }}" class="btn btn-sm btn-outline-primary">View Details</a>
                        <a href="{{ url_for('resources.view', id=entry.resource.id) }}" class="btn btn-sm btn-outline-secondary">View Resource</a>
                        <form method="POST" action="{{ url_for('booking.cancel_waitlist', id=entry.id) }}" class="d-inline" onsubmit="return confirm('Are you sure you want to cancel this waitlist entry?');">
                            <button type="submit" class="btn btn-sm btn-outline-danger">Cancel</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info">
        <p class="mb-0">You don't have any waitlist entries.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

